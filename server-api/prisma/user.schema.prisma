// server-api/prisma/user.schema.prisma

generator client {
  provider        = "prisma-client-js"
  output          = "../node_modules/@prisma/client-user"
  // Removed "multiSchema" preview feature since we are focusing on public only
}

datasource db {
  provider  = "postgresql"
  url       = env("USER_DATABASE_URL")
  directUrl = env("USER_DIRECT_URL")
  // Removed schemas array. Default is "public", which is what we want.
}

// --- PUBLIC SCHEMA TABLES ---

model User {
  id           String   @id @db.Uuid
  email        String?
  full_name    String?
  phone_number String?  @unique // Added unique here for findUnique queries
  age          Int?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  bookings     Booking[]
  wishlist     WishlistItem[]

  // Removed relation to auth.users to prevent permission errors

  @@map("profiles")
}

model Booking {
  id                BigInt   @id @default(autoincrement())
  user_id           String   @db.Uuid
  expert_name       String?  @default("Mr. Kamraann Rajjani")
  consultation_date DateTime @db.Date
  slot              String
  product_skus      String[]
  meet_link         String?
  status            String?  @default("confirmed")
  created_at        DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  user              User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("bookings")
}

model WishlistItem {
  id            BigInt   @id @default(autoincrement())
  user_id       String   @db.Uuid
  product_sku   String
  product_name  String?
  product_image String?
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, product_sku])
  @@map("wishlist_items")
}