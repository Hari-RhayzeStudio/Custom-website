// server-api/prisma/user.schema.prisma

generator client {
  provider        = "prisma-client-js"
  output          = "../../node_modules/@prisma/client-user"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("USER_DATABASE_URL")
  directUrl = env("USER_DIRECT_URL")
  schemas   = ["auth", "public"]
}

// --- YOUR TABLES (PUBLIC SCHEMA) ---

model User {
  id           String   @id @db.Uuid
  email        String?
  full_name    String?
  phone_number String?
  age          Int?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  bookings     Booking[]
  wishlist     WishlistItem[]
  
  // Link to Supabase Auth User
  authUser     users    @relation(fields: [id], references: [id], onDelete: Cascade)

  @@map("profiles")       // Maps "User" in code -> "profiles" in DB
  @@schema("public")
}

model Booking {
  id                BigInt   @id @default(autoincrement())
  user_id           String   @db.Uuid
  expert_name       String?  @default("Mr. Kamraann Rajjani")
  consultation_date DateTime @db.Date
  slot              String
  product_skus      String[]
  meet_link         String?
  status            String?  @default("confirmed")
  created_at        DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  user              User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("bookings")
  @@schema("public")
}

model WishlistItem {
  id            BigInt   @id @default(autoincrement())
  user_id       String   @db.Uuid
  product_sku   String
  product_name  String?
  product_image String?
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, product_sku])
  @@map("wishlist_items")
  @@schema("public")
}

// --- SUPABASE SYSTEM TABLE (AUTH SCHEMA) ---
// We only need this so Prisma understands the Foreign Key in the User model above.

model users {
  id    String @id @db.Uuid
  email String? @db.VarChar(255)
  phone String? @unique

  // Back relation to your profile
  profile User?

  @@map("users")
  @@schema("auth")
}